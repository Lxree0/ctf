<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>{{ challenge.title }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style_dashboard.css') }}">
<style>
.help-panel { 
  position: fixed;
  right: 20px;
  bottom: 80px;
  width: 300px;
  max-width: calc(100% - 40px);
  background: #0000005d;
  border: 1px solid #05e168;
  padding: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  z-index: 9999;
}
.hidden { display: none !important; }
.fixed-toggle-btn {
  position: fixed;
  right: 20px;
  bottom: 20px;
  z-index: 10000;
  padding: 10px 14px;
  border-radius: 8px;
}
.button-group button {
  padding: 8px 12px;
  margin-top: 8px;
}
.error-message { color: #b00; }

.web-btn {
    background: linear-gradient(90deg, #2575fc, #6a11cb);
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1rem;
    border-radius: 20px;
    cursor: pointer;
    margin: 8px;
    transition: 0.2s;
}

.web-btn:hover {
    background-color: #45a049;
}

</style>
</head>

<body>

<div class="challenge-wrapper">
    <div class="ctf-box">
        <h2>{{ challenge.title }}</h2>
        <p>{{ challenge.description }}</p>

        <!-- Pulsante dinamico in base alla categoria -->
        <div class="button-group">
        {% if challenge.category == 'Cripto' %}
            <button id="downloadBtn" class="redirect-btn download-btn" type="button">Scarica file</button>
        {% elif challenge.category == 'Web' %}
            <div style="text-align: center;">
                <a href="{{ url_for('extra', challenge_id=challenge.id) }}" class="redirect-btn download-btn"target="_blank" rel="noopener noreferrer">Apri Sito </a>
            </div>
        {% elif challenge.category == 'Misc' %}
            <button id="downloadBtn" class="redirect-btn download-btn" type="button">Scarica file</button>
        {% endif %}
        </div>

        <form action="{{ url_for('submit') }}" method="post">
            <input type="hidden" name="challenge_id" value="{{ challenge.id }}">
            <input type="text" name="flag" placeholder="SPWGRG{inserisci_la_flag}" required>
            <button type="submit">Submit</button>
        </form>

        {% if error %}
        <p class="error-message">{{ error }}</p>
        {% endif %}
    </div>
</div>

<!-- PULSANTE FLUTTUANTE IN BASSO A DESTRA -->
<button id="toggle-help-btn" class="fixed-toggle-btn" type="button">❓ Aiuto</button>

<!-- BOX AIUTO (dinamico in base alla categoria) -->
<div id="help-panel" class="help-panel hidden">
    <h2>Suggerimento CTF</h2>
    {% if challenge.id == 1 %}
        <p> Chissà cosa potrà mai significare questo strano alfabeto... <a href="https://it.wikipedia.org/wiki/Codice_Morse"> alfabeto morse</a> <br> le ||| <b>blu</b> dividono le parole</p>
    {% elif challenge.id == 2 %}
        <p> la posizione di ogni lettera corrisponde alla posizione dell'alfabeto normale ma di 3 posti avanti, anche i numeri sono spostati di 3 avanti <a href="https://it.wikipedia.org/wiki/Cifrario_di_Cesare">Cifrario di Cesare</a></p>
    {% elif challenge.id == 3 %}
        <p>Ogni carattere è rappresentato da una combinazione di sei posizioni disponibili. Stai cercando un sistema di scrittura tattile! <a href="https://it.wikipedia.org/wiki/Braille"> Codice Braille</a></p>
    {% elif challenge.id == 4 %}
        <p>Dovrai usare la tabella di conversione dell'Alfabeto Galattico Standard (SGA) per la traduzione. <br> <br> La parola chiave tradotta inizia con 4 e finisce con G.</p>
    {% elif challenge.id == 5 %}
        <p>La sua funzione è quella di generare un nemico volante che ti attacca di notte <br> Stai cercando lo Spawn Egg (Uovo di Spawn) di una creatura eterea. L'ID è un numero a 3 cifre, l'anno è dopo il 2017</p>
    {% elif challenge.id == 6 %}
        <p>La steganografia potrebbe centrare qualcosa? </p>
    {% elif challenge.id == 7 %}
        <p>L’admin dovrebbe cambiare la password, è troppo scontata… </p>
    {% elif challenge.id == 8 %}
        <p>Hai mai esaminato/ispezionato una pagina web?</p>
    {% elif challenge.id == 9 %}
        <p>Non tutto ciò che serve è già nell’url, manca un tassello…</p>
    {% elif challenge.id == 10 %}
        <p>Buoni questi cookies… ma sono commestibili?</p>
    {% else %}
        <p>Nessun suggerimento disponibile.</p>
    {% endif %}
    <p class="signature">Buona fortuna!</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const challengeId = "{{ challenge.id }}";

    // Solo se il download button esiste
    const downloadBtn = document.getElementById("downloadBtn");
    if (downloadBtn) {
        downloadBtn.addEventListener("click", function () {
            const link = document.createElement("a");
           if (challengeId == 4 ||challengeId == 5 ||challengeId == 6 ) {
            link.href = `{{ url_for('static', filename='files') }}/${challengeId}.png`;
            link.download = `challenge_${challengeId}.png`;
            } else {
            link.href = `{{ url_for('static', filename='files') }}/${challengeId}.txt`;
            link.download = `file_challenge_${challengeId}.txt`;
            }
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    }

    const toggleBtn = document.getElementById("toggle-help-btn");
    const helpPanel = document.getElementById("help-panel");
    if (toggleBtn && helpPanel) {
        toggleBtn.addEventListener("click", function () {
            helpPanel.classList.toggle('hidden');
            toggleBtn.textContent = helpPanel.classList.contains('hidden') ? '❓ Aiuto' : '✖ Chiudi Aiuto';
        });
    }
});
</script>

</body>
</html>
